/* eslint-disable @next/next/no-img-element */
import Head from 'next/head';
import Image from 'next/image';
import Layout from './producto/layout';
import Link from 'next/link';
import { useRouter } from 'next/router';

//importar firebase
import firebaseApp from '../firebase';
import {
	getFirestore,
	collection,
	addDoc,
	getDocs,
	doc,
	deleteDoc,
	getDoc,
	setDoc,
} from 'firebase/firestore';
import { async } from '@firebase/util';
import { getStorage } from 'firebase/storage';

const db = getFirestore(firebaseApp);
const storage = getStorage(firebaseApp);

//
export default function Productos({ productos }) {
	const router = useRouter();

	return (
		<Layout>
			<Head>
				<title>CZ Productos</title>
				<meta name='description' content='Generated by create next app' />
				<link rel='icon' href='/favicon.ico' />
			</Head>
			<div className='w-3/4  mx-auto mt-10'>
				<div className='flex justify-center'>
					<Link href='./formulario'>
						<button className='bg-red-300 mb-4'>Agregar producto</button>
					</Link>
				</div>
				<div className='grid grid-cols-4 gap-4 bg-gray-400'>
					{productos.map((product) => (
						<div className='' key={product.id}>
							<h5 className='text-lg font-bold'>{product.name}</h5>
							<div className='h-20'>
								<img
									src={product.url}
									alt='img'
									className='object-contain bg-red-400'
								/>
							</div>
							<div className='text bg-blue-200'>
								<p>{product.desc}</p>
							</div>
							<div className='text bg-green-300'>
								<p>{product.price}â‚¬</p>
							</div>

							<button
								className='bg-blue-200 px-3 py-1 rounded text-white  bottom-1'
								onClick={() => router.push(`/producto/${product.id}`)}
							>
								View
							</button>
						</div>
					))}
				</div>
			</div>
		</Layout>
	);
}

export const getServerSideProps = async (context) => {
	const querySnapshot = await getDocs(collection(db, 'producto'));
	const docs = [];
	querySnapshot.forEach((doc) => {
		docs.push({ ...doc.data(), id: doc.id });
	});

	return {
		props: {
			productos: docs,
		},
	};
};
